generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x", "debian-openssl-3.0.x"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model ScrapeJob {
  id                String   @id @default(uuid())
  url               String
  categoryName      String?
  status            String   @default("pending") // pending, discovering, processing, completed, failed, paused
  progress          Int      @default(0)
  totalProducts     Int      @default(0)
  processedProducts Int      @default(0)
  discoveredProducts Int     @default(0) // Produtos descobertos até agora
  currentPage       Int      @default(1) // Página atual sendo descoberta
  currentProduct    String?
  zipPath           String?
  errorMessage      String?
  lastProcessedPage String?  // Para retomar paginação
  lastProductIndex  Int      @default(0) // Índice do último produto processado
  canResume         Boolean  @default(false) // Indica se pode retomar
  urlOnlyMode       Boolean  @default(false) // Modo somente URLs
  excelData         Bytes?   // Dados do Excel em memória
  createdAt         DateTime @default(now())
  completedAt       DateTime?
  products          Product[]

  @@map("scrape_jobs")
}

model Product {
  id           String    @id @default(uuid())
  jobId        String
  name         String
  description  String?
  price        String?
  originalUrl  String
  imagePaths   String[]  @default([])
  folderName   String
  status       String    @default("pending") // pending, processing, completed, failed
  errorMessage String?
  createdAt    DateTime  @default(now())
  completedAt  DateTime?
  
  job          ScrapeJob @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@map("products")
}
